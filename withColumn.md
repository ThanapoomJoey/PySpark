# ðŸ”§ à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™ `withColumn()` à¹ƒà¸™ PySpark

`withColumn()` à¹€à¸›à¹‡à¸™à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸³à¸„à¸±à¸à¹ƒà¸™ PySpark à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸ªà¸³à¸«à¸£à¸±à¸šà¸à¸²à¸£à¸ªà¸£à¹‰à¸²à¸‡à¸«à¸£à¸·à¸­à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¹ƒà¸™ DataFrame

---

## âœ… à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸«à¸¥à¸±à¸à¸‚à¸­à¸‡ `withColumn()`

### 1. à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¹ƒà¸«à¸¡à¹ˆ  
à¹€à¸žà¸´à¹ˆà¸¡à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¹ƒà¸«à¸¡à¹ˆà¸ˆà¸²à¸à¸à¸²à¸£à¸„à¸³à¸™à¸§à¸“à¸«à¸£à¸·à¸­à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸•à¹ˆà¸²à¸‡ à¹†
```python
from pyspark.sql.functions import col
df = df.withColumn("age_plus_5", col("age") + 5)
 ```

### 2. à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹à¸›à¸¥à¸‡à¸„à¹ˆà¸²à¸‚à¸­à¸‡à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¹€à¸”à¸´à¸¡  
à¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸Šà¹‰à¸Šà¸·à¹ˆà¸­à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¹€à¸”à¸´à¸¡à¹ƒà¸™ `withColumn()` à¹€à¸žà¸·à¹ˆà¸­à¸­à¸±à¸›à¹€à¸”à¸•à¸„à¹ˆà¸²à¸—à¸±à¸šà¸‚à¸­à¸‡à¹€à¸”à¸´à¸¡à¹„à¸”à¹‰à¹€à¸¥à¸¢
```python
df = df.withColumn("age", col("age") + 10)  # à¹à¸à¹‰ age à¹ƒà¸«à¹‰à¹€à¸žà¸´à¹ˆà¸¡à¸‚à¸¶à¹‰à¸™ 10 à¸›à¸µ
 ```

### 3. à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸Šà¸™à¸´à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (Data Type Casting)  
à¹ƒà¸Šà¹‰à¹à¸›à¸¥à¸‡à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ à¹€à¸Šà¹ˆà¸™ à¸ˆà¸²à¸à¸ˆà¸³à¸™à¸§à¸™à¹€à¸•à¹‡à¸¡à¹€à¸›à¹‡à¸™à¸ªà¸•à¸£à¸´à¸‡ à¸«à¸£à¸·à¸­à¸ˆà¸²à¸à¸ªà¸•à¸£à¸´à¸‡à¹€à¸›à¹‡à¸™à¸§à¸±à¸™à¸—à¸µà¹ˆ

```python
df = df.withColumn("age", col("age").cast("int"))
 ```

| à¸Šà¸™à¸´à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (string à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¹ƒà¸™ cast) | à¸Šà¸™à¸´à¸”à¸ˆà¸£à¸´à¸‡à¹ƒà¸™ PySpark | à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸ |
|-----------------------------------|---------------------|----------|
| `"string"`                        | `StringType`        | à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ |
| `"int"` à¸«à¸£à¸·à¸­ `"integer"`         | `IntegerType`       | à¸ˆà¸³à¸™à¸§à¸™à¹€à¸•à¹‡à¸¡ 32-bit |
| `"long"`                          | `LongType`          | à¸ˆà¸³à¸™à¸§à¸™à¹€à¸•à¹‡à¸¡ 64-bit |
| `"float"`                         | `FloatType`         | à¸—à¸¨à¸™à¸´à¸¢à¸¡ 32-bit |
| `"double"`                        | `DoubleType`        | à¸—à¸¨à¸™à¸´à¸¢à¸¡ 64-bit |
| `"boolean"`                       | `BooleanType`       | à¸ˆà¸£à¸´à¸‡ / à¹€à¸—à¹‡à¸ˆ |
| `"date"`                          | `DateType`          | à¸§à¸±à¸™à¸—à¸µà¹ˆ |
| `"timestamp"`                    | `TimestampType`     | à¸§à¸±à¸™-à¹€à¸§à¸¥à¸² |

### 4. à¹ƒà¸Šà¹‰à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚ if-else (`when-otherwise`)  
à¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸Šà¹‰à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚à¹à¸šà¸š if-else à¹€à¸žà¸·à¹ˆà¸­à¸à¸³à¸«à¸™à¸”à¸„à¹ˆà¸²à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸•à¸²à¸¡à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚
```python
from pyspark.sql.functions import when

df = df.withColumn("age_group", when(col("age") > 30, "à¸ªà¸¹à¸‡à¸à¸§à¹ˆà¸² 30").otherwise("à¸•à¹ˆà¸³à¸à¸§à¹ˆà¸² 30"))
 ```

### 5. à¸›à¸£à¸±à¸šà¹à¸•à¹ˆà¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ (String Transformation)  
à¹ƒà¸Šà¹‰à¸£à¹ˆà¸§à¸¡à¸à¸±à¸šà¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ˆà¸±à¸”à¸à¸²à¸£à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡ à¹€à¸Šà¹ˆà¸™ à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¸žà¸´à¸¡à¸žà¹Œà¹ƒà¸«à¸à¹ˆ à¸žà¸´à¸¡à¸žà¹Œà¹€à¸¥à¹‡à¸ à¸«à¸£à¸·à¸­à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
**`upper()`**: à¹à¸›à¸¥à¸‡à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¸žà¸´à¸¡à¸žà¹Œà¹ƒà¸«à¸à¹ˆ
```python
from pyspark.sql.functions import upper

df = df.withcolumn("name_upper", upper(col("name")))
 ```
**`lower()`**: à¹à¸›à¸¥à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¸žà¸´à¸¡à¸žà¹Œà¹€à¸¥à¹‡à¸
```python
from pyspark.sql.functions import lower

df = df.withColumn("name_lower", lower(col("name")))
 ```
**`trim()`**: à¸•à¸±à¸”à¸Šà¹ˆà¸­à¸‡à¸§à¹ˆà¸²à¸‡à¸‚à¹‰à¸²à¸‡à¸«à¸™à¹‰à¸²à¹à¸¥à¸°à¸‚à¹‰à¸²à¸‡à¸«à¸¥à¸±à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
```python
from pyspark.sql.functions import trim

df = df.withColumn("trimmed_name", trim(col("name")))
 ```

**`ltrim()`**: à¸•à¸±à¸”à¸Šà¹ˆà¸­à¸‡à¸§à¹ˆà¸²à¸‡à¸—à¸µà¹ˆà¸”à¹‰à¸²à¸™à¸‹à¹‰à¸²à¸¢à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
```python
from pyspark.sql.functions import ltrim , length

df = df.withColumn("left", ltrim(col("name")))

df.withColumn("length_ltrim",length(col("left"))).show()
 ```

**`rtrim()`**: à¸•à¸±à¸”à¸Šà¹ˆà¸­à¸‡à¸§à¹ˆà¸²à¸‡à¸—à¸µà¹ˆà¸”à¹‰à¸²à¸™à¸‚à¸§à¸²à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
```python
from pyspark.sql.functions import rtrim

df = df.withColumn("right_trimmed_name", rtrim(col("name")))
 ```

**`concat()`**: à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ˆà¸²à¸à¸«à¸¥à¸²à¸¢à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ
```python
from pyspark.sql.functions import concat , col , lit

df.withColumn("fullname", concat(col("firstname"), lit(" ") ,col("lastname"))).show()
 ```

**`substr()`**: à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸šà¸²à¸‡à¸ªà¹ˆà¸§à¸™à¸ˆà¸²à¸ string (à¸•à¸²à¸¡ index)
```python
from pyspark.sql.functions import substr
df = df.withColumn("substring_name", substr(col("name"), 1, 5)) #à¹€à¸£à¸´à¹ˆà¸¡à¸ˆà¸²à¸à¸•à¸±à¸§à¸—à¸µà¹ˆ 1 à¸„à¸§à¸²à¸¡à¸¢à¸²à¸§ 5 à¸•à¸±à¸§
 ```

**`initcap()`**: à¹à¸›à¸¥à¸‡à¹ƒà¸«à¹‰à¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£à¹à¸£à¸à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¸žà¸´à¸¡à¸žà¹Œà¹ƒà¸«à¸à¹ˆ (capital letter)
```python
from pyspark.sql.functions import initcap

df = df.withColumn("name_initcap", initcap(col("name")))
 ```

**`translate()`**: à¹à¸—à¸™à¸—à¸µà¹ˆà¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£à¹ƒà¸™à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡
```python
from pyspark.sql.functions import translate

df = df.withColumn("replaced_name", translate(col("name"), "aeiou", "12345"))
 ```
**`regexp_replace()`**: à¹à¸—à¸™à¸—à¸µà¹ˆà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸•à¸²à¸¡ pattern
```python
from pyspark.sql.functions import regexp_replace

df = df.withColumn("clean_name", regexp_replace(col("name"), "John", "Johnny"))  # à¹à¸—à¸™à¸—à¸µà¹ˆ "John" à¹€à¸›à¹‡à¸™ "Johnny"
 ```

**`regexp_extract()`** à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ˆà¸²à¸ pattern
```python
from pyspark.sql.functions import regexp_extract

df = df.withColumn("first_letter", regexp_extract(col("name"), "^(.)", 1))  # à¸”à¸¶à¸‡à¸•à¸±à¸§à¹à¸£à¸à¸ˆà¸²à¸ "name"
 ```
à¸£à¸§à¸¡à¸ªà¸¹à¸•à¸£ regexp à¸—à¸µà¹ˆà¸ªà¸³à¸„à¸±à¸ [Regex_Cheat_Sheet_ETL.md](Regex_Cheat_Sheet_ETL.md)

 ðŸ” à¸ªà¸£à¸¸à¸›à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ **String Transformation** à¸—à¸µà¹ˆà¹ƒà¸Šà¹‰à¸šà¹ˆà¸­à¸¢

| à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™           | à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢                          | à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡                                            |
|---------------------|------------------------------------|-----------------------------------------------------|
| **`upper()`**        | à¹à¸›à¸¥à¸‡à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¸žà¸´à¸¡à¸žà¹Œà¹ƒà¸«à¸à¹ˆ              | `upper(col("name"))`                                |
| **`lower()`**        | à¹à¸›à¸¥à¸‡à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¸žà¸´à¸¡à¸žà¹Œà¹€à¸¥à¹‡à¸              | `lower(col("name"))`                                |
| **`trim()`**         | à¸•à¸±à¸”à¸Šà¹ˆà¸­à¸‡à¸§à¹ˆà¸²à¸‡à¸‚à¹‰à¸²à¸‡à¸«à¸™à¹‰à¸²à¹à¸¥à¸°à¸‚à¹‰à¸²à¸‡à¸«à¸¥à¸±à¸‡    | `trim(col("name"))`                                 |
| **`ltrim()`**        | à¸•à¸±à¸”à¸Šà¹ˆà¸­à¸‡à¸§à¹ˆà¸²à¸‡à¸”à¹‰à¸²à¸™à¸‹à¹‰à¸²à¸¢               | `ltrim(col("name"))`                                |
| **`rtrim()`**        | à¸•à¸±à¸”à¸Šà¹ˆà¸­à¸‡à¸§à¹ˆà¸²à¸‡à¸”à¹‰à¸²à¸™à¸‚à¸§à¸²                | `rtrim(col("name"))`                                |
| **`concat()`**       | à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ˆà¸²à¸à¸«à¸¥à¸²à¸¢à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ       | `concat(col("first_name"), col("last_name"))`       |
| **`substr()`**       | à¸•à¸±à¸”à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸šà¸²à¸‡à¸ªà¹ˆà¸§à¸™à¸ˆà¸²à¸ string       | `substr(col("name"), 1, 5)`                         |
| **`initcap()`**      | à¹à¸›à¸¥à¸‡à¹ƒà¸«à¹‰à¸•à¸±à¸§à¹à¸£à¸à¹€à¸›à¹‡à¸™à¸•à¸±à¸§à¸žà¸´à¸¡à¸žà¹Œà¹ƒà¸«à¸à¹ˆ     | `initcap(col("name"))`                              |
| **`translate()`**    | à¹à¸—à¸™à¸—à¸µà¹ˆà¸•à¸±à¸§à¸­à¸±à¸à¸©à¸£à¹ƒà¸™à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡           | `translate(col("name"), "aeiou", "12345")`          |
| **`regexp_replace()`**| à¹à¸—à¸™à¸—à¸µà¹ˆà¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸•à¸²à¸¡ pattern          | `regexp_replace(col("name"), "John", "Johnny")`     |
| **`regexp_extract()`**| à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡à¸ˆà¸²à¸ pattern             | `regexp_extract(col("name"), "^(.)", 1)`            |

### 6. à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸ˆà¸²à¸à¸«à¸¥à¸²à¸¢à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œ  
à¸£à¸§à¸¡à¸„à¹ˆà¸²à¸ˆà¸²à¸à¸«à¸¥à¸²à¸¢à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸¡à¸²à¹„à¸§à¹‰à¹ƒà¸™à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¹ƒà¸«à¸¡à¹ˆ à¹€à¸Šà¹ˆà¸™ à¸à¸²à¸£à¸„à¸¹à¸“à¸«à¸²à¸œà¸¥à¸£à¸§à¸¡
```python
df.withColumn("total",col("quantity") * col("unit_price")).show()
 ```

### 7. à¹ƒà¸ªà¹ˆà¸„à¹ˆà¸²à¸„à¸‡à¸—à¸µà¹ˆ (Literal)  
à¹€à¸žà¸´à¹ˆà¸¡à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸—à¸µà¹ˆà¸¡à¸µà¸„à¹ˆà¸²à¸„à¸‡à¸—à¸µà¹ˆ à¹€à¸Šà¹ˆà¸™ à¸›à¸£à¸°à¹€à¸—à¸¨, à¸ªà¸–à¸²à¸™à¸°, à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆ
```python
from pyspark.sql.functions import lit

df = df.withColumn("country", lit("Thailand"))
 ```

### 8. à¹ƒà¸Šà¹‰à¸£à¹ˆà¸§à¸¡à¸à¸±à¸š UDF (User Defined Function)  
à¹ƒà¸Šà¹‰à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹€à¸‚à¸µà¸¢à¸™à¹€à¸­à¸‡à¹€à¸žà¸·à¹ˆà¸­à¸ªà¸£à¹‰à¸²à¸‡à¸«à¸£à¸·à¸­à¹à¸›à¸¥à¸‡à¸„à¹ˆà¸²à¸„à¸­à¸¥à¸±à¸¡à¸™à¹Œà¸•à¸²à¸¡ logic à¸—à¸µà¹ˆà¸‹à¸±à¸šà¸‹à¹‰à¸­à¸™
```python
from pyspark.sql.functions import udf
from pyspark.sql.types import StringType

def custom_label(age):
    return "senior" if age >= 60 else "junior"

label_udf = udf(custom_label, StringType())
df = df.withColumn("label", label_udf(col("age")))
 ```